<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Statistics - Datatouille</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            font-family: 'Roboto', sans-serif;
            background-color: #f4f4f4;
        }
        #nav-bar {
            background-color: #343a40;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            height: 100px;
        }
        .navbar-title, .navbar-logo-container {
            display: flex;
            align-items: center;
        }
        .navbar-logo {
            height: 60px;
            margin-right: 2px;
        }
        .navbar-title {
            color: rgb(248, 9, 9);
            font-size: 28px;
            font-weight: bold;
            font-family: 'Montserrat', sans-serif;
        }
        .navbar-nav {
            display: flex;
            justify-content: flex-end;
            align-items: center;
        }
        .navbar a {
            color: white;
            padding: 14px 30px;
            text-decoration: none;
            text-align: center;
            display: block;
            font-size: 18px;
        }
        #content-area {
            display: flex;
            justify-content: center;
            padding: 20px;
            flex-wrap: wrap; /* Allow the boxes to wrap if needed */
            gap: 20px; /* Add some space between the boxes if they wrap */
        }

        #chart-box, #explanation-box {
            flex: 1; /* Each box takes equal width */
            margin: 10px; /* Adds some space between the boxes */
            min-width: 500px; /* Set a minimum width for each box */
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #e8e8e8;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            justify-content: start;
            align-items: center;
            /* Set the height to be at least as tall as the chart, adjust as necessary */
            min-height: 500px; 
        }

        #content-area-horizontal {
            display: flex;
            justify-content: center;
            padding: 10px;
            flex-wrap: wrap;
            gap: 20px;
        }

        #horizontal-chart-box {
            flex: 1;
            margin: 10px;
            min-width: 600px; /* Adjust based on your layout */
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #e8e8e8;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            justify-content: start;
            align-items: center;
            min-height: 500px;
        }


        /* Add specific styles for SVG to avoid overflow */
        #chart svg {
            max-width: 100%;
            height: auto; /* Adjust height proportionally */
        }
        .tooltip {
            position: absolute;
            text-align: center;
            padding: 6px;
            font-size: 14px;
            background: lightsteelblue;
            border: 0px;
            border-radius: 4px;
            pointer-events: none;
            opacity: 0;
        }
        .grid line {
            stroke: rgb(67, 61, 61);
            stroke-opacity: 0.7;
            shape-rendering: crispEdges;
        }
        .grid path {
            stroke-width: 0;
        }
        #horizontal-chart-container {
            margin: auto;
            width: 80%;
            padding: 20px;
            background-color: #f7c0c0;  
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); 
            border-radius: 8px;  
        }

        #filter-container {
            text-align: center;
            margin-bottom: 20px;
        }

        .filter-btn {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            background-color: #e8e8e8;
            cursor: pointer;
            border-radius: 5px;
            outline: none;
        }

        .filter-btn.selected {
            background-color: #007bff;
            color: white;
        }

        #horizontal-chart-box {
            padding: 20px;
        }

        .tooltip {
            position: absolute;
            text-align: center;
            padding: 6px 10px;
            background: rgba(0, 0, 0, 0.8);
            color: lightsteelblue;
            border-radius: 4px;
            pointer-events: none;
            opacity: 0;
        }
    </style>
</head>
<body>
    <div id="nav-bar" class="navbar navbar-expand-lg navbar-dark">
        <div class="navbar-logo-container">
            <img src="../static/images/website_logo.jpg" class="navbar-logo" alt="Website Logo">
            <a href="../index.html" class="navbar-title-link">
                <div class="navbar-title">Datatouille</div>
            </a>
        </div>
        <div class="navbar-nav ml-auto">
            <a class="nav-item nav-link" href="../index.html">Home</a>
            <a class="nav-item nav-link" href="../templates/michelin_guide.html">Michelin Guide</a>
            <a class="nav-item nav-link active" href="#statistics">Statistics</a>
            <a class="nav-item nav-link" href="../templates/about_us.html">About Us</a>
            <a class="nav-item nav-link" href="../templates/about_project.html">Project</a>
        </div>
    </div>
    <div id="content-area">
        <div id="chart-box">
            <h2 style="text-align: center;">Michelin Guide Listings by Continent</h2>
            <div id="chart"></div>
        </div>
        <div id="explanation-box">
            <h2 style="text-align: center;">Chart Explanation</h2>
            <p>This chart visualizes the distribution of Michelin Guide listings by continent, showing a significant concentration in Europe, followed by Asia, North America, and South America. Detailed statistics help stakeholders understand market penetration and growth opportunities.</p>
        </div>
    </div>

    <div id="horizontal-chart-container">
        <h2 style="text-align: center;">Michelin Guide Listings by Country</h2>
        <div id="filter-container">
            <button class="filter-btn" data-continent="All">All</button>
            <button class="filter-btn" data-continent="Asia">Asia</button>
            <button class="filter-btn" data-continent="Europe">Europe</button>
            <button class="filter-btn" data-continent="North America">North America</button>
            <button class="filter-btn" data-continent="South America">South America</button>
        </div>
        <div id="horizontal-chart-box">
            <div id="horizontal-chart"></div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const data = [
                {"Continent": "Asia", "Listings": 1894},
                {"Continent": "Europe", "Listings": 4178},
                {"Continent": "North America", "Listings": 661},
                {"Continent": "South America", "Listings": 61}
            ];

            const margin = {top: 30, right: 30, bottom: 70, left: 60},
                width = 460 - margin.left - margin.right,
                height = 400 - margin.top - margin.bottom;

            const svg = d3.select("#chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // Create the X-axis band scale
            const x = d3.scaleBand()
                .range([0, width])
                .domain(data.map(d => d.Continent))
                .padding(0.2);

            // Draw the X-axis on the DOM
            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x));

            // Create the Y-axis linear scale
            const y = d3.scaleLinear()
                .domain([0, 4500])
                .range([height, 0]);

            // Draw the Y-axis on the DOM
            svg.append("g")
                .call(d3.axisLeft(y));

            // Add the Y-grid lines
            function makeYGridlines() { 
                return d3.axisLeft(y).ticks(5);
            }

            svg.append("g")
                .attr("class", "grid")
                .call(makeYGridlines()
                    .tickSize(-width)
                    .tickFormat("")
                );

            // Color scale
            const colorScale = d3.scaleOrdinal(d3.schemeCategory10);

            // Tooltip setup
            const tooltip = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

            // Bar chart setup
            svg.selectAll(".bar")
                .data(data)
                .enter()
                .append("rect")
                .attr("class", "bar")
                .attr("x", d => x(d.Continent))
                .attr("width", x.bandwidth())
                .attr("fill", d => colorScale(d.Continent))
                .attr("y", y(0))
                .attr("height", 0) // Start bars at the bottom of the chart
                .on("mouseover", (event, d) => {
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", .9);
                    tooltip.html("Continent: " + d.Continent + "<br/>Listings: " + d.Listings)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", (event, d) => {
                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                });

            // Animation for bars
            svg.selectAll(".bar")
                .transition()
                .duration(800)
                .attr("y", d => y(d.Listings))
                .attr("height", d => height - y(d.Listings));
        });
        
        document.addEventListener("DOMContentLoaded", function() {
            const dataHorizontal = [
                {"Country": "France", "Listings": 1016, "Continent": "Europe"},
                {"Country": "Japan", "Listings": 733, "Continent": "Asia"},
                {"Country": "Italy", "Listings": 651, "Continent": "Europe"},
                {"Country": "USA", "Listings": 600, "Continent": "North America"},
                {"Country": "Germany", "Listings": 581, "Continent": "Europe"},
                {"Country": "Spain", "Listings": 500, "Continent": "Europe"},
                {"Country": "United Kingdom", "Listings": 275, "Continent": "Europe"},
                {"Country": "Belgium", "Listings": 270, "Continent": "Europe"},
                {"Country": "Switzerland", "Listings": 257, "Continent": "Europe"},
                {"Country": "China Mainland", "Listings": 242, "Continent": "Asia"},
                {"Country": "Thailand", "Listings": 231, "Continent": "Asia"},
                {"Country": "Netherlands", "Listings": 219, "Continent": "Europe"},
                {"Country": "Taiwan", "Listings": 182, "Continent": "Asia"},
                {"Country": "Hong Kong SAR China", "Listings": 139, "Continent": "Asia"},
                {"Country": "Singapore", "Listings": 132, "Continent": "Asia"},
                {"Country": "South Korea", "Listings": 89, "Continent": "Asia"},
                {"Country": "Portugal", "Listings": 73, "Continent": "Europe"},
                {"Country": "Canada", "Listings": 61, "Continent": "North America"},
                {"Country": "Malaysia", "Listings": 50, "Continent": "Asia"},
                {"Country": "Brazil", "Listings": 47, "Continent": "South America"},
                {"Country": "Denmark", "Listings": 47, "Continent": "Europe"},
                {"Country": "United Arab Emirates", "Listings": 41, "Continent": "Asia"},
                {"Country": "Türkiye", "Listings": 38, "Continent": "Europe"},
                {"Country": "Vietnam", "Listings": 33, "Continent": "Asia"},
                {"Country": "Ireland", "Listings": 33, "Continent": "Europe"},
                {"Country": "Sweden", "Listings": 29, "Continent": "Europe"},
                {"Country": "Austria", "Listings": 25, "Continent": "Europe"},
                {"Country": "Croatia", "Listings": 25, "Continent": "Europe"},
                {"Country": "Macau SAR China", "Listings": 22, "Continent": "Asia"},
                {"Country": "Norway", "Listings": 21, "Continent": "Europe"},
                {"Country": "Greece", "Listings": 17, "Continent": "Europe"},
                {"Country": "Slovenia", "Listings": 16, "Continent": "Europe"},
                {"Country": "Luxembourg", "Listings": 16, "Continent": "Europe"},
                {"Country": "Hungary", "Listings": 15, "Continent": "Europe"},
                {"Country": "Argentina", "Listings": 14, "Continent": "South America"},
                {"Country": "Poland", "Listings": 10, "Continent": "Europe"},
                {"Country": "Malta", "Listings": 10, "Continent": "Europe"},
                {"Country": "Finland", "Listings": 9, "Continent": "Europe"},
                {"Country": "Estonia", "Listings": 8, "Continent": "Europe"},
                {"Country": "Czech Republic", "Listings": 7, "Continent": "Europe"},
                {"Country": "Latvia", "Listings": 4, "Continent": "Europe"},
                {"Country": "Iceland", "Listings": 3, "Continent": "Europe"},
                {"Country": "Serbia", "Listings": 2, "Continent": "Europe"},
                {"Country": "Andorra", "Listings": 1, "Continent": "Europe"}
            ];

            let activeContinents = new Set();

            const margin = {top: 20, right: 30, bottom: 40, left: 180},
                width = 960 - margin.left - margin.right,
                height = 500 - margin.top - margin.bottom;

            const svg = d3.select("#horizontal-chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const x = d3.scaleLinear()
                .range([0, width]);

            const y = d3.scaleBand()
                .padding(0.1)
                .range([0, height]);

            const color = d3.scaleOrdinal(d3.schemeCategory10);

            const tooltip = d3.select("body").append("div")
                .attr("class", "tooltip");

            function updateChart() {
                let filteredData = activeContinents.size === 0 ? dataHorizontal :
                    dataHorizontal.filter(d => activeContinents.has(d.Continent));
                filteredData = filteredData.sort((a, b) => b.Listings - a.Listings).slice(0, 10);

                x.domain([0, d3.max(filteredData, d => d.Listings)]);
                y.domain(filteredData.map(d => d.Country));

                svg.selectAll(".bar").remove();
                svg.selectAll(".axis").remove();

                svg.append("g")
                    .attr("class", "axis axis--y")
                    .call(d3.axisLeft(y));

                svg.append("g")
                    .attr("class", "axis axis--x")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x));

                svg.selectAll(".bar")
                    .data(filteredData)
                    .enter().append("rect")
                    .attr("class", "bar")
                    .attr("y", d => y(d.Country))
                    .attr("height", y.bandwidth())
                    .attr("x", 0)
                    .attr("width", d => x(d.Listings))
                    .attr("fill", d => color(d.Country))
                    .on("mouseover", function(event, d) {
                        tooltip.transition().duration(200).style("opacity", .9);
                        tooltip.html(d.Country + ": " + d.Listings)
                            .style("left", (event.pageX + 5) + "px")
                            .style("top", (event.pageY - 28) + "px");
                    })
                    .on("mouseout", function(d) {
                        tooltip.transition().duration(500).style("opacity", 0);
                    });
            }

            document.querySelectorAll(".filter-btn").forEach(btn => {
                btn.addEventListener("click", function() {
                    const continent = this.dataset.continent;
                    if (continent === "All") {
                        activeContinents.clear();
                        document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("selected"));
                    } else {
                        if (activeContinents.has(continent)) {
                            activeContinents.delete(continent);
                            this.classList.remove("selected");
                        } else {
                            activeContinents.add(continent);
                            this.classList.add("selected");
                        }
                    }
                    updateChart();
                });
            });

            updateChart();  // Initialize the chart
        });


    </script>

</body>
</html>
